<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DesignStudio - AI SocialStudio</title>
    <meta name="description" content="Describe your idea, and we'll craft the caption, hashtags, and visuals">
    <link rel="icon" href="/static/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
    <meta name="theme-color" content="#ffffff">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Anton&family=Bangers&family=Dancing+Script:wght@700&family=Lobster&family=Montserrat:wght@900&family=Orbitron:wght@700&family=Oswald&family=Pacifico&family=Playfair+Display:ital,wght@1,700&family=Roboto:wght@500&family=Satisfy&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #F8FAFC; 
        }

        .custom-scroll::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: transparent; 
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 10px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .checkered-bg {
            background-image: linear-gradient(45deg, #e2e8f0 25%, transparent 25%), 
                              linear-gradient(-45deg, #e2e8f0 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #e2e8f0 75%), 
                              linear-gradient(-45deg, transparent 75%, #e2e8f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #ffffff;
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            padding: 0;
            overflow: hidden;
            border-radius: 50%; 
            width: 24px;
            height: 24px;
            appearance: none;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 50%;
        }

        input[type=range] {
            -webkit-appearance: none; 
            appearance: none;
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden text-slate-700 flex flex-col lg:flex-row">
    <aside class="w-full lg:w-[380px] flex-shrink-0 bg-white border-b lg:border-b-0 lg:border-r border-slate-200 flex flex-col z-20 shadow-[4px_0_24px_rgba(0,0,0,0.02)] h-[45vh] lg:h-full order-2 lg:order-1">
        <div class="h-16 flex items-center px-6 border-b border-slate-100 flex-shrink-0 bg-white z-10 sticky top-0 group">
            <div class="w-8 h-8 rounded-xl flex items-center border border-gray-200 justify-center shadow-xs mr-2">
                 <svg width="23" height="23" viewBox="0 -2 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7601.000000)" fill="currentColor"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M102.8695,7446.25504 C101.3625,7444.73916 98.9185,7444.73916 97.4115,7446.25504 L91.2705,7452.43224 C90.8935,7452.81045 90.8935,7453.42505 91.2705,7453.80428 C91.6475,7454.1835 92.2585,7454.1835 92.6355,7453.80428 L98.7755,7447.62809 C99.5285,7446.86964 100.7515,7446.86964 101.5045,7447.62809 C102.2585,7448.38552 102.2585,7449.61473 101.5045,7450.37317 L95.4825,7456.43066 C96.2355,7457.1881 97.4575,7457.1881 98.2115,7456.43066 L102.8695,7451.74521 C104.3765,7450.22933 104.3765,7447.77092 102.8695,7446.25504 M100.8225,7448.31411 C100.4455,7447.93488 99.8345,7447.93488 99.4575,7448.31411 L93.3175,7454.49029 C92.5635,7455.24874 91.3415,7455.24874 90.5885,7454.49029 C90.2115,7454.11107 89.6005,7454.11107 89.2235,7454.49029 C88.8465,7454.86952 88.8465,7455.48412 89.2235,7455.86233 C90.7305,7457.37922 93.1745,7457.37922 94.6825,7455.86233 L100.8225,7449.68615 C101.1995,7449.30793 101.1995,7448.69232 100.8225,7448.31411 M98.7755,7442.13691 C97.2685,7440.62103 94.8245,7440.62103 93.3175,7442.13691 L87.1765,7448.31411 C86.8005,7448.69232 86.8005,7449.30793 87.1765,7449.68615 C87.5535,7450.06537 88.1645,7450.06537 88.5415,7449.68615 L94.6825,7443.50996 C95.4355,7442.75151 96.6575,7442.75151 97.4105,7443.50996 C97.7875,7443.88918 98.3985,7443.88918 98.7755,7443.50996 C99.1525,7443.13073 99.1525,7442.51613 98.7755,7442.13691 M96.7285,7444.19598 C96.3515,7443.81675 95.7405,7443.81675 95.3645,7444.19598 L89.2235,7450.37317 C88.4695,7451.13061 87.2485,7451.13061 86.4945,7450.37317 C85.7405,7449.61473 85.7405,7448.38552 86.4945,7447.62708 L92.5175,7441.56959 C91.7635,7440.81114 90.5415,7440.81114 89.7875,7441.56959 L85.1295,7446.25504 C83.6235,7447.77092 83.6235,7450.22933 85.1295,7451.74521 C86.6375,7453.2621 89.0805,7453.2621 90.5885,7451.74521 L96.7285,7445.56902 C97.1055,7445.1898 97.1055,7444.5752 96.7285,7444.19598" id="squarespace-[#132]"></path></g></g></g></svg>
            </div>
        
            <a href="/design" class="cursor-pointer">
                <div class="flex items-center overflow-hidden ">
                    <span class="font-bold text-slate-800 text-lg tracking-tight whitespace-nowrap">
                        Design<span class="text-gray-400">Studio</span>
                    </span>
                    
                    <div id="ai-tag-container" class="flex items-center transition-all duration-500 ease-in-out max-w-0 opacity-0 group-hover:max-w-xs group-hover:opacity-100 group-hover:ml-1">
                        <span class="text-xs mt-[5px] font-thin whitespace-nowrap text-gray-500">
                            from AI SocialStudio
                        </span>
                    </div>
                </div>
            </a>
        </div>
        <div class="flex-1 overflow-y-auto custom-scroll p-6 space-y-8">
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Canvas Size</label>
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="resizeCanvas(500,500)" class="text-xs font-medium text-slate-600 bg-slate-50 border border-slate-200 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 py-2.5 rounded-xl transition shadow-sm">Square</button>
                    <button onclick="resizeCanvas(360,640)" class="text-xs font-medium text-slate-600 bg-slate-50 border border-slate-200 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 py-2.5 rounded-xl transition shadow-sm">Story</button>
                    <button onclick="resizeCanvas(640,360)" class="text-xs font-medium text-slate-600 bg-slate-50 border border-slate-200 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 py-2.5 rounded-xl transition shadow-sm">Video</button>
                </div>

                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                    <div class="text-xs font-semibold text-slate-500 mb-3">Background Color</div>
                    <div class="flex gap-3 items-center">
                        <!-- Transparent -->
                        <button onclick="setWorkspace('transparent')" class="w-8 h-8 rounded-full border border-slate-300 checkered-bg hover:scale-110 transition shadow-sm" title="Transparent"></button>
                        <button onclick="setWorkspace('#ffffff')" class="w-8 h-8 rounded-full border border-slate-200 bg-white hover:scale-110 transition shadow-sm"></button>
                        <button onclick="setWorkspace('#000000')" class="w-8 h-8 rounded-full border border-slate-200 bg-black hover:scale-110 transition shadow-sm"></button>
                        <div class="relative w-8 h-8 group hover:scale-110 transition">
                            <input type="color" onchange="setWorkspace(this.value)" class="absolute opacity-0 w-full h-full cursor-pointer z-10">
                            <div class="w-full h-full rounded-full border border-slate-200 bg-gradient-to-br from-blue-400 to-purple-500 shadow-sm flex items-center justify-center">
                                <i data-lucide="plus" class="w-3 h-3 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. Typography -->
            <div class="space-y-4">
                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Add Text</label>
                
                <div class="flex gap-2">
                    <input type="text" id="text-input" placeholder="Type something..." class="flex-1 bg-white border border-slate-200 rounded-xl px-4 py-2.5 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition shadow-sm">
                    <button onclick="addText()" class="bg-slate-900 hover:bg-slate-800 text-white w-10 rounded-xl flex items-center justify-center transition shadow-lg shadow-slate-900/20">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="font-family" onchange="updateSelectedObject()" class="col-span-2 w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-xs font-medium focus:outline-none focus:border-blue-500 cursor-pointer">
                        <option value="Arial">Arial (Standard)</option>
                        <option value="Roboto">Roboto (Modern)</option>
                        <option value="Montserrat">Montserrat (Bold)</option>
                        <option value="Playfair Display">Playfair (Elegant)</option>
                        <option value="Lobster">Lobster (Cursive)</option>
                        <option value="Pacifico">Pacifico (Brush)</option>
                        <option value="Anton">Anton (Heavy)</option>
                        <option value="Orbitron">Orbitron (Sci-Fi)</option>
                    </select>

                    <div class="bg-slate-50 border border-slate-100 rounded-xl p-2 flex items-center justify-between">
                        <span class="text-[10px] font-semibold text-slate-500">Fill</span>
                        <input type="color" id="text-color" onchange="updateSelectedObject()" value="#000000">
                    </div>
                    <div class="bg-slate-50 border border-slate-100 rounded-xl p-2 flex items-center justify-between">
                        <span class="text-[10px] font-semibold text-slate-500">Border</span>
                        <input type="color" id="text-stroke-color" onchange="updateSelectedObject()" value="#000000">
                    </div>
                </div>

                <div class="px-1">
                    <div class="flex justify-between text-[10px] font-semibold text-slate-400 mb-2">
                        <span>Border Thickness</span>
                        <span id="stroke-val">0px</span>
                    </div>
                    <input type="range" id="text-stroke-width" oninput="updateSelectedObject()" min="0" max="5" step="0.1" value="0" class="w-full accent-blue-600">
                </div>
            </div>

            <!-- 3. Assets Library -->
            <div class="space-y-4 border-b border-slate-100 pb-4">
                <div class="flex justify-between items-end">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Library</label>
                    <label class="cursor-pointer group">
                        <input type="file" id="img-upload" accept="image/*" class="hidden">
                        <span class="text-[10px] font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg group-hover:bg-blue-100 transition">
                            + Upload
                        </span>
                    </label>
                </div>
                
                <div id="logo-gallery" class="grid grid-cols-3 gap-3">
                    <p class="text-xs text-slate-400 col-span-3 text-center py-8 italic bg-slate-50 rounded-xl border border-dashed border-slate-200">
                        Connecting to server...
                    </p>
                </div>
            </div>

            <!-- 4. SAVED TEMPLATES (NEW) -->
            <div class="space-y-4">
                <div class="flex justify-between items-end">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">My Templates</label>
                    <button onclick="fetchTemplates()" class="text-[10px] font-bold text-slate-500 hover:text-blue-600 transition">
                        <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                    </button>
                </div>
                
                <div id="templates-gallery" class="grid grid-cols-2 gap-2">
                   <!-- Templates injected here -->
                   <div class="col-span-2 text-xs text-slate-400 text-center py-4 bg-slate-50 rounded-xl border border-dashed border-slate-200">
                       No saved templates
                   </div>
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="p-4 border-t border-slate-100 bg-white space-y-3 flex-shrink-0 z-10">
            <div class="flex gap-2">
                <button onclick="deleteSelected()" class="w-12 flex items-center justify-center bg-white text-rose-500 hover:bg-rose-50 py-3 rounded-xl text-sm font-semibold transition border border-rose-100 shadow-sm">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
                
                <!-- SAVE TEMPLATE BUTTON (NEW) -->
                <button onclick="saveTemplate()" class="flex-1 flex items-center justify-center gap-2 bg-white text-slate-700 hover:bg-slate-50 py-3 rounded-xl text-sm font-bold border border-slate-200 transition">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    Save
                </button>

                <button onclick="downloadImage()" class="flex-1 flex items-center justify-center gap-2 bg-slate-900 hover:bg-slate-800 text-white py-3 rounded-xl text-sm font-bold shadow-lg shadow-slate-900/20 transition transform active:scale-95">
                    Download
                </button>
            </div>
        </div>
    </aside>

    <!-- RIGHT: WORKSPACE (Canvas) -->
    <main class="flex-1 bg-slate-100/50 relative overflow-hidden flex flex-col order-1 lg:order-2 h-[55vh] lg:h-full">
        
        <!-- Mobile/Desktop Top Bar -->
        <div class="absolute top-4 left-0 w-full px-4 flex justify-between z-10 pointer-events-none">
            <div class="pointer-events-auto bg-white/80 backdrop-blur-md border border-white/50 text-slate-500 text-[10px] font-bold uppercase tracking-wider px-3 py-1.5 rounded-full shadow-sm">
                Workspace
            </div>
            <div class="pointer-events-auto bg-white/80 backdrop-blur-md border border-white/50 text-slate-500 text-xs px-3 py-1.5 rounded-full shadow-sm flex items-center gap-1.5">
                <i data-lucide="mouse-pointer-2" class="w-3 h-3"></i> 
                <span class="hidden sm:inline">Select & Drag</span>
            </div>
        </div>

        <!-- Canvas Container -->
        <div class="flex-1 w-full h-full overflow-auto flex items-center justify-center p-4 lg:p-10 custom-scroll" id="canvas-container">
            <div id="workspace-wrapper" class="shadow-[0_20px_50px_rgba(0,0,0,0.1)] transition-all duration-300 rounded-sm">
                <!-- Canvas Element -->
                <canvas id="c"></canvas>
            </div>
        </div>

    </main>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // --- 1. SETUP CANVAS ---
        const canvas = new fabric.Canvas('c', {
            width: 500,
            height: 500,
            backgroundColor: null // Default transparency
        });

        // --- 2. BACKEND INTEGRATION ---
        async function fetchLogos() {
            try {
                // Assuming existing backend route
                const response = await fetch('/api/logos');
                if(!response.ok) throw new Error('Failed');
                const logos = await response.json();
                
                const gallery = document.getElementById('logo-gallery');
                gallery.innerHTML = ''; 

                if(logos.length === 0) {
                    gallery.innerHTML = `
                        <div class="col-span-3 flex flex-col items-center py-6 text-slate-400 bg-slate-50 rounded-xl border border-dashed border-slate-200">
                            <i data-lucide="image" class="w-6 h-6 mb-2 opacity-50"></i>
                            <span class="text-xs">No assets found</span>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }

                logos.forEach(logo => {
                    const imgDiv = document.createElement('div');
                    imgDiv.className = "aspect-square bg-white border border-slate-200 rounded-xl flex items-center justify-center cursor-pointer hover:border-blue-500 hover:shadow-md transition overflow-hidden group relative p-2";
                    imgDiv.innerHTML = `<img src="/designs/${logo.filename}" class="w-full h-full object-contain group-hover:scale-105 transition duration-300" alt="${logo.name}">`;
                    imgDiv.onclick = () => addImageToCanvas(`/designs/${logo.filename}`);
                    gallery.appendChild(imgDiv);
                });

            } catch (error) {
                console.warn("Could not load logos (Backend might be offline)", error);
                document.getElementById('logo-gallery').innerHTML = '<p class="text-xs text-slate-400 col-span-3 text-center">Local mode</p>';
            }
        }
        
        fetchLogos();

        // --- NEW: TEMPLATE SYSTEM ---
        
        async function saveTemplate() {
            const name = prompt("Enter a name for this template:");
            if (!name) return;

            // Serialize canvas to JSON
            const canvasJson = canvas.toJSON(); 
            const payload = {
                name: name,
                canvas_json: canvasJson,
                canvas_width: canvas.width,
                canvas_height: canvas.height
            };

            try {
                const response = await fetch('/api/templates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert("Template saved successfully!");
                    fetchTemplates(); // Refresh list
                } else {
                    alert("Failed to save template.");
                }
            } catch (err) {
                console.error(err);
                alert("Error connecting to server.");
            }
        }

        async function fetchTemplates() {
            try {
                const response = await fetch('/api/templates');
                if (!response.ok) return;
                const templates = await response.json();

                const container = document.getElementById('templates-gallery');
                container.innerHTML = '';

                if (templates.length === 0) {
                    container.innerHTML = '<div class="col-span-2 text-xs text-slate-400 text-center py-4 bg-slate-50 rounded-xl border border-dashed border-slate-200">No saved templates</div>';
                    return;
                }

                templates.forEach(t => {
                    const el = document.createElement('div');
                    el.className = "group relative bg-white border border-slate-200 rounded-xl p-3 hover:border-blue-500 transition cursor-pointer";
                    el.innerHTML = `
                        <div class="text-xs font-bold text-slate-700 mb-1 truncate">${t.name}</div>
                        <div class="text-[10px] text-slate-400">${new Date(t.created_at).toLocaleDateString()}</div>
                        <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition">
                             <button class="p-1 hover:bg-rose-50 text-rose-500 rounded" onclick="event.stopPropagation(); deleteTemplate('${t.template_id}')">
                                <i data-lucide="trash" class="w-3 h-3"></i>
                             </button>
                        </div>
                    `;
                    el.onclick = () => loadTemplate(t);
                    container.appendChild(el);
                });
                lucide.createIcons();

            } catch (err) {
                console.warn("Could not fetch templates");
            }
        }

        async function deleteTemplate(id) {
            if(!confirm("Delete this template?")) return;
            await fetch(`/api/templates/${id}`, { method: 'DELETE' });
            fetchTemplates();
        }

        function loadTemplate(template) {
            if(!confirm("Load template? This will replace your current canvas.")) return;

            // 1. Resize canvas to template dimensions
            resizeCanvas(template.canvas_width, template.canvas_height);

            // 2. Load JSON
            canvas.loadFromJSON(template.canvas_json, function() {
                canvas.renderAll();
                console.log("Template loaded");
            });
        }

        // Initialize templates on load
        fetchTemplates();

        // --- 3. OBJECT MANAGEMENT ---
        
        function addText() {
            const textValue = document.getElementById('text-input').value || "Double Click Me";
            const colorValue = document.getElementById('text-color').value;
            const fontValue = document.getElementById('font-family').value;

            const text = new fabric.IText(textValue, {
                left: canvas.width / 2 - 100,
                top: canvas.height / 2,
                fontFamily: fontValue,
                fill: colorValue,
                fontSize: 40,
                strokeWidth: 0,
                stroke: '#000000',
                originX: 'center',
                originY: 'center'
            });

            canvas.add(text);
            canvas.setActiveObject(text);
            canvas.renderAll();
        }

        function addImageToCanvas(url) {
            fabric.Image.fromURL(url, function(img) {
                const maxDim = Math.min(canvas.width, canvas.height) * 0.5;
                const scale = Math.min(maxDim / img.width, maxDim / img.height);
                
                img.set({
                    left: canvas.width/2 - (img.width * scale)/2,
                    top: canvas.height/2 - (img.height * scale)/2,
                    scaleX: scale,
                    scaleY: scale
                });
                canvas.add(img);
                canvas.setActiveObject(img);
                canvas.renderAll();
            }, { crossOrigin: 'anonymous' });
        }

        function updateSelectedObject() {
            const activeObj = canvas.getActiveObject();
            if (!activeObj) return;

            const fill = document.getElementById('text-color').value;
            const stroke = document.getElementById('text-stroke-color').value;
            const strokeWidth = parseFloat(document.getElementById('text-stroke-width').value);
            const font = document.getElementById('font-family').value;

            document.getElementById('stroke-val').innerText = strokeWidth + "px";

            if (activeObj.type === 'i-text') {
                activeObj.set({
                    fill: fill,
                    stroke: stroke,
                    strokeWidth: strokeWidth,
                    fontFamily: font
                });
            }
            
            canvas.renderAll();
        }

        canvas.on('selection:created', syncTools);
        canvas.on('selection:updated', syncTools);
        
        function syncTools(e) {
            const obj = e.selected[0];
            if (obj && obj.type === 'i-text') {
                document.getElementById('text-color').value = obj.fill;
                document.getElementById('text-stroke-color').value = obj.stroke || "#000000";
                document.getElementById('text-stroke-width').value = obj.strokeWidth || 0;
                document.getElementById('font-family').value = obj.fontFamily;
                document.getElementById('stroke-val').innerText = (obj.strokeWidth || 0) + "px";
            }
        }
        function resizeCanvas(w, h) {
            canvas.setDimensions({ width: w, height: h });
        }

        function setWorkspace(color) {
            const wrapper = document.getElementById('workspace-wrapper');
            
            if (color === 'transparent') {
                wrapper.classList.add('checkered-bg');
                wrapper.style.backgroundColor = 'transparent';

                canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
            } else {

                wrapper.classList.remove('checkered-bg');
                wrapper.style.backgroundColor = color;

                canvas.setBackgroundColor(color, canvas.renderAll.bind(canvas));
            }
        }

        // --- 6. UTILS ---

        document.getElementById('img-upload').addEventListener('change', function(e) {
            if(e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (f) => addImageToCanvas(f.target.result);
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        function deleteSelected() {
            const activeObjects = canvas.getActiveObjects();
            if (activeObjects.length) {
                canvas.discardActiveObject();
                activeObjects.forEach((obj) => {
                    canvas.remove(obj);
                });
            }
        }

        function downloadImage() {
            canvas.discardActiveObject();
            canvas.renderAll();
            
            const link = document.createElement('a');
            link.download = `design-studio-${Date.now()}.png`;
            link.href = canvas.toDataURL({ 
                format: 'png', 
                quality: 2, 
                multiplier: 4 
            });
            link.click();
        }
        window.onload = function() {
            if(window.innerWidth < 1024) {
            }
        }
        window.addEventListener('DOMContentLoaded', () => {
            const aiTag = document.getElementById('ai-tag-container');

            aiTag.classList.remove('max-w-0', 'opacity-0');
            aiTag.classList.add('max-w-xs', 'opacity-100', 'ml-1');

            setTimeout(() => {
                aiTag.classList.add('max-w-0', 'opacity-0');
                aiTag.classList.remove('max-w-xs', 'opacity-100', 'ml-1');
            }, 5000);
        });
    </script>
</body>
</html>